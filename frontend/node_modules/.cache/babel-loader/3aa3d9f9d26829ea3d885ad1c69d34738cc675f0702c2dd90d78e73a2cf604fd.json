{"ast":null,"code":"import _regeneratorRuntime from\"D:/\\u041F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B/social-space/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/\\u041F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B/social-space/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/\\u041F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B/social-space/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import convertDate from\"../../features/convertDate\";import getCookie from\"../../features/getCookie\";import{useSelector,useDispatch}from'react-redux';import{close}from'../../features/redux/openChatSlice';import{useState}from\"react\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";export default function ChatOpen(props){var openChat=useSelector(function(state){return state.openChat.value;});var idChat=useSelector(function(state){return state.idChat.value;});var dispatch=useDispatch();var _useState=useState(),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var message=[];var chat=document.querySelector(\"#ChatInfo\");if(props.data!=null){props.data.forEach(function(element){if(element.username===idChat&&element.type===\"private\"){var data=[element.text,convertDate(element.date),element.chatId,element.messageId,element.username,element.answers,element.textPhoto];message.push(data);}});}var sendMessage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var botId,element,_chat;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!text){_context2.next=15;break;}_context2.next=3;return fetch('https://localhost:7013/api/user/GetInfo/'+getCookie(\"userId\")).then(function(Response){return Response.json();}).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(Result){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",Result.responseData[\"usingBots\"].toString().split('----')[0]);case 1:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());case 3:botId=_context2.sent;_context2.next=6;return fetch(\"https://localhost:7013/api/telegram/sendMessage/\",{method:'POST',headers:{'Accept':'application/json','Content-Type':'application/json'},body:JSON.stringify({BotId:botId.toString(),ChatId:message[message.length-1][2].toString(),MessageId:message[message.length-1][3].toString(),Text:text.toString()})});case 6:element=document.getElementById(\"message\");element.value=\"\";setText(null);_context2.next=11;return document.querySelector(\"#ChatInfo\");case 11:_chat=_context2.sent;if(_chat!=null){_chat.scrollTop=Math.pow(10,10);}_context2.next=16;break;case 15:alert(\"Напишите сообщение\");case 16:case\"end\":return _context2.stop();}},_callee2);}));return function sendMessage(){return _ref.apply(this,arguments);};}();var textHandler=function textHandler(event){setText(event.target.value);chat.scrollTop=Math.pow(10,10);};if(chat!=null){if(chat.scrollTop===0){chat.scrollTop=Math.pow(10,10);};}var handleKeyPress=function handleKeyPress(e){if(e.key===\"Enter\"){sendMessage();}};if(openChat===false){return null;}else{return/*#__PURE__*/_jsxs(\"div\",{className:\"OpenChat\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"\\u0427\\u0430\\u0442 \\u0441 \",idChat]}),/*#__PURE__*/_jsx(\"div\",{id:\"ChatInfo\",className:\"ChatInfo\",children:message.reverse().map(function(data,index){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"ChatInfoElement\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"ChatInfoElementMessage\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"data:image/jpeg;base64,\"+data[6],alt:\"\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text\",children:data[0]}),/*#__PURE__*/_jsx(\"p\",{className:\"time\",children:data[1]})]})}),data[5]?data[5].reverse().sort(function(a,b){if(a.split('/')[1]>b.split('/')[1]){return 1;}if(a.split('/')[1]<b.split('/')[1]){return-1;}return 0;}).map(function(answer,index){return/*#__PURE__*/_jsxs(\"div\",{className:\"ChatAnswerElement\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text\",children:answer.split(\"/\")[0]}),/*#__PURE__*/_jsx(\"p\",{className:\"time\",children:answer.split(\"/\")[1]})]},index);}):null]},index);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"answer\",children:[/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(event){return textHandler(event);},onKeyDown:handleKeyPress,name:\"message\",id:\"message\",type:text,placeholder:\"\\u041D\\u0430\\u043F\\u0438\\u0448\\u0438\\u0442\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435...\"}),/*#__PURE__*/_jsx(\"div\",{className:\"buttons\",children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return sendMessage();},children:\"\\u041E\\u0442\\u0432\\u0435\\u0442\\u0438\\u0442\\u044C\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return dispatch(close());},children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C \\u0447\\u0430\\u0442\"})]})]});}}","map":{"version":3,"names":["convertDate","getCookie","useSelector","useDispatch","close","useState","ChatOpen","props","openChat","state","value","idChat","dispatch","text","setText","message","chat","document","querySelector","data","forEach","element","username","type","date","chatId","messageId","answers","textPhoto","push","sendMessage","fetch","then","Response","json","Result","responseData","toString","split","botId","method","headers","body","JSON","stringify","BotId","ChatId","length","MessageId","Text","getElementById","scrollTop","Math","pow","alert","textHandler","event","target","handleKeyPress","e","key","reverse","map","index","sort","a","b","answer"],"sources":["D:/Проекты/social-space/frontend/src/component/Chat/ChatOpen.jsx"],"sourcesContent":["import convertDate from \"../../features/convertDate\";\r\nimport getCookie from \"../../features/getCookie\";\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { close } from '../../features/redux/openChatSlice';\r\nimport { useState } from \"react\";\r\n\r\nexport default function ChatOpen(props) {\r\n    const openChat = useSelector((state) => state.openChat.value)\r\n    const idChat = useSelector((state) => state.idChat.value)\r\n    const dispatch = useDispatch()\r\n    const [text, setText] = useState();\r\n\r\n    let message = [];\r\n\r\n    let chat = document.querySelector(\"#ChatInfo\");\r\n\r\n    if(props.data != null){\r\n        props.data.forEach(element => {\r\n            if(element.username === idChat && element.type === \"private\"){\r\n                let data = [element.text, convertDate(element.date), element.chatId, element.messageId, element.username, element.answers, element.textPhoto];\r\n                message.push(data);\r\n            }\r\n        });\r\n    }\r\n    \r\n    const sendMessage = async () => {\r\n        if(text){\r\n            let botId = await fetch('https://localhost:7013/api/user/GetInfo/' + getCookie(\"userId\"))\r\n            .then((Response) => Response.json())\r\n            .then(async (Result) => { return Result.responseData[\"usingBots\"].toString().split('----')[0] });\r\n            \r\n            await fetch(\"https://localhost:7013/api/telegram/sendMessage/\", { \r\n                method: 'POST',\r\n                headers: {\r\n                    'Accept': 'application/json',\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    BotId: botId.toString(), \r\n                    ChatId: message[message.length-1][2].toString(), \r\n                    MessageId: message[message.length-1][3].toString(),\r\n                    Text: text.toString(), \r\n                })\r\n            });\r\n\r\n            let element = document.getElementById(\"message\");\r\n            element.value = \"\";\r\n            setText(null);\r\n            \r\n            let chat = await document.querySelector(\"#ChatInfo\");\r\n            if(chat != null){\r\n                chat.scrollTop = Math.pow(10, 10);\r\n            }\r\n        } else{\r\n            alert(\"Напишите сообщение\")\r\n        }\r\n    }\r\n    \r\n    const textHandler = (event) => {\r\n        setText(event.target.value);\r\n        chat.scrollTop = Math.pow(10,10);\r\n    }\r\n    \r\n    if(chat != null){\r\n        if(chat.scrollTop === 0){\r\n            chat.scrollTop = Math.pow(10,10);\r\n        };\r\n    }\r\n\r\n    const handleKeyPress = (e) => {\r\n        if(e.key === \"Enter\"){\r\n            sendMessage();\r\n        }\r\n    } \r\n\r\n    if(openChat === false){\r\n        return null\r\n    } else{\r\n        return(\r\n            <div className=\"OpenChat\">   \r\n                <h1>Чат с {idChat}</h1>\r\n                <div id=\"ChatInfo\" className=\"ChatInfo\">\r\n                    {message.reverse().map((data, index) => { \r\n                        return (\r\n                            <div key = {index} >\r\n                                <div className = \"ChatInfoElement\"> \r\n                                    <div className=\"ChatInfoElementMessage\">\r\n                                        <img src={\"data:image/jpeg;base64,\" + data[6] } alt=\"\" />\r\n                                        <p className=\"text\">{ data[0] }</p>\r\n                                        <p className=\"time\">{ data[1] }</p>\r\n                                    </div>\r\n                                </div>\r\n                                { data[5] ? data[5].reverse().sort(function(a,b){\r\n                                    if(a.split('/')[1] > b.split('/')[1]){\r\n                                        return 1;\r\n                                    }\r\n                                    if(a.split('/')[1] < b.split('/')[1]){\r\n                                        return -1;\r\n                                    }\r\n                                    return 0;\r\n                                }).map((answer, index) => {\r\n                                    return(\r\n                                        <div className = \"ChatAnswerElement\" key={index}>\r\n                                            <p className = \"text\">{ answer.split(\"/\")[0] }</p>\r\n                                            <p className = \"time\">{ answer.split(\"/\")[1] }</p> \r\n                                        </div>\r\n                                    )\r\n                                }) : null}\r\n                            </div>\r\n                        )\r\n                    })}\r\n                </div>\r\n                <div className=\"answer\">\r\n                    <input onChange={(event) => textHandler(event)} onKeyDown={handleKeyPress} name=\"message\" id=\"message\" type={text} placeholder=\"Напишите сообщение...\"></input>\r\n                    <div className=\"buttons\">\r\n                        <button onClick={() => sendMessage()}>Ответить</button>\r\n                    </div>\r\n                    <button onClick={ () => dispatch(close()) }>Закрыть чат</button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}